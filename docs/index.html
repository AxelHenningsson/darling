
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DARLING &#8212; darling 1.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/jquery.js?v=5d32c60e"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="_static/documentation_options.js?v=8d563738"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'index';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
  
    <p class="title logo__title">darling 1.0.0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none"></div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="toctree-wrapper compound">
</div>
<section id="darling">
<h1>DARLING<a class="headerlink" href="#darling" title="Link to this heading">#</a></h1>
<p>the python <strong>[D]ark</strong> field x-ray microscopy <strong>[A]nalysis</strong> &amp; <strong>[R]econstruction</strong> <strong>[L]ibrary</strong> for rapid data <strong>[IN]spection</strong> &amp; <strong>[G]raphing</strong></p>
<a class="reference external image-reference" href="https://www.python.org/"><img alt="cross-platform" src="https://img.shields.io/badge/platform-cross--platform-brightgreen.svg" />
</a>
<a class="reference external image-reference" href="https://www.python.org/"><img alt="pure python" src="https://img.shields.io/badge/code-pure%20python-blue.svg" />
</a>
<a class="reference external image-reference" href="https://github.com/AxelHenningsson/darling/actions/workflows/pytest-linux-py310.yml"><img alt="tests ubuntu-linux" src="https://github.com/AxelHenningsson/darling/actions/workflows/pytest-linux-py310.yml/badge.svg" />
</a>
<a class="reference external image-reference" href="https://github.com/psf/black"><img alt="code style black" src="https://img.shields.io/badge/code%20style-black-000000.svg" />
</a>
<a class="reference external image-reference" href="https://axelhenningsson.github.io/darling/"><img alt="Sphinx documentation" src="https://img.shields.io/badge/docs-sphinx-blue.svg" />
</a>
</section>
<section id="authors">
<h1>Authors<a class="headerlink" href="#authors" title="Link to this heading">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">darling</span></code> is written and maintained by:</p>
<p><a class="reference external" href="https://github.com/AxelHenningsson">Axel Henningsson</a>,
<a class="reference external" href="https://github.com/adcret">Felix Tristan Frankus</a> and
<a class="reference external" href="https://github.com/fetrifra">Adam André William Cretton</a></p>
<p>affiliated with DTU. The core ideas of this library was originally written during a beamtime at ESRF id03D.</p>
<p>Until an associated journal publication is available, if you use this code in your research, we ask that you cite this repository.</p>
<p>If you are interested in collaborating with us on DFXM data analysis, please reach out to us at: <a class="reference external" href="mailto:naxhe&#37;&#52;&#48;dtu&#46;dk">naxhe<span>&#64;</span>dtu<span>&#46;</span>dk</a>
and we can discuss the possibilities.</p>
</section>
<section id="usecase">
<h1>Usecase<a class="headerlink" href="#usecase" title="Link to this heading">#</a></h1>
<section id="loading-plotting-data">
<h2>Loading &amp; plotting Data<a class="headerlink" href="#loading-plotting-data" title="Link to this heading">#</a></h2>
<p>Darling collects many useful tools in the properties module.</p>
<p>For example, it is possible to model the angular intensity distribution of a scan using a Gaussian Mixture Model (GMM)
and then color code the scan based on the first maxima of the GMM using a RGB color map known as a mosaicity map.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># read some toy data in</span>
<span class="n">path_to_data</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">domains</span><span class="p">()</span>  <span class="c1"># replace with your own data</span>
<span class="n">scan_id</span> <span class="o">=</span> <span class="s2">&quot;1.1&quot;</span>  <span class="c1"># tope level key in the hdf5 file</span>
<span class="n">dset</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">DataSet</span><span class="p">(</span><span class="n">path_to_data</span><span class="p">,</span> <span class="n">scan_id</span><span class="p">)</span>

<span class="c1"># model the intensity distribution using a GMM</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">gaussian_mixture</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">dset</span><span class="o">.</span><span class="n">motors</span><span class="p">)</span>

<span class="c1"># color code the scan based on the first maxima of the GMM</span>
<span class="n">first_maxima_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
   <span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;mean_motor1&quot;</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;mean_motor2&quot;</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">]),</span>
   <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">rgbmap</span><span class="p">,</span> <span class="n">colorkey</span><span class="p">,</span> <span class="n">colorgrid</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span>
   <span class="n">first_maxima_mean</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">dset</span><span class="o">.</span><span class="n">motors</span>
<span class="p">)</span>
</pre></div>
</div>
<p>To visualize the resulting mosaicity map, you can use the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># plot the resulting mosaicity map</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;dark_background&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgbmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="https://github.com/AxelHenningsson/darling/blob/dev/docs/source/images/domains_mosa.png?raw=true" class="align-center" src="https://github.com/AxelHenningsson/darling/blob/dev/docs/source/images/domains_mosa.png?raw=true" />
<p>for more examples see the externally hosted documentation at <a class="reference external" href="https://axelhenningsson.github.io/darling/">https://axelhenningsson.github.io/darling/</a></p>
</section>
</section>
<section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Link to this heading">#</a></h1>
<p>From source the key is simply to clone and pip install</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/AxelHenningsson/darling.git
<span class="nb">cd</span><span class="w"> </span>darling
pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</pre></div>
</div>
<p>In general, you probably want to install in a fresh virtual environment as</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv_darling
<span class="nb">source</span><span class="w"> </span>.venv_darling/bin/activate
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/AxelHenningsson/darling.git
<span class="nb">cd</span><span class="w"> </span>darling
pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</pre></div>
</div>
<p>use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>.venv_darling/bin/activate
</pre></div>
</div>
<p>whenever you want to activate the environment. To add your env into a jupyter kernel such that
you can use it in an interactive notebook you may add the following two commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>ipykernel
python<span class="w"> </span>-m<span class="w"> </span>ipykernel<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>--name<span class="o">=</span>darling
</pre></div>
</div>
<section id="note-on-jupyter-the-esrf-slurm-cluster">
<h2>Note on jupyter &amp; the ESRF slurm cluster<a class="headerlink" href="#note-on-jupyter-the-esrf-slurm-cluster" title="Link to this heading">#</a></h2>
<p>In the main ESRF slurm Python jupyter kernel it is possible to do the following hack to get the latest <cite>darling</cite> running.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/AxelHenningsson/darling.git
sys.path.insert<span class="o">(</span><span class="m">0</span>,<span class="w"> </span>os.path.abspath<span class="o">(</span><span class="s1">&#39;./darling&#39;</span><span class="o">))</span>
import<span class="w"> </span>darling
</pre></div>
</div>
<p>This trick is possible since that all dependencies of <cite>darling</cite> are already installed in the big Python jupyter kernel at ESRF.</p>
<p>The following snippet has also been verified to work on the ESRF slurm cluster 19 Dec 2024 in a browser terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv_darling
<span class="nb">source</span><span class="w"> </span>.venv_darling/bin/activate
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/AxelHenningsson/darling.git
<span class="nb">cd</span><span class="w"> </span>darling
pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
pip<span class="w"> </span>install<span class="w"> </span>ipykernel
python<span class="w"> </span>-m<span class="w"> </span>ipykernel<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>--name<span class="o">=</span>darling
</pre></div>
</div>
<p>This appraoch should work on other clusters as well, as long as some user permission to install exists.</p>
</section>
</section>
<section id="documentation">
<h1>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">#</a></h1>
<p>Darling hosts documentation at <a class="reference external" href="https://axelhenningsson.github.io/darling/">https://axelhenningsson.github.io/darling/</a></p>
<section id="module-darling._dataset">
<span id="dataset"></span><h2>DataSet<a class="headerlink" href="#module-darling._dataset" title="Link to this heading">#</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="darling._dataset.DataSet">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">darling._dataset.</span></span><span class="sig-name descname"><span class="pre">DataSet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_source</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_motor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/_dataset.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling._dataset.DataSet" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A DFXM data-set.</p>
<p>This is the master data class of darling. Given a data source the DataSet class will read data from
arbitrary layers, process, threshold, compute moments, visualize results, and compile 3D feature maps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>(</strong> (<em>data_source</em>) – obj: <cite>string</cite> or <cite>darling.reader.Reader</cite>): A string to the absolute h5 file path
location of the data, or a reader object implementing the darling.reader.Reader() interface.</p></li>
<li><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – scan id or scan ids to load. Defaults to None,
in which case no data is loaded on instantiation. In this case use load_scan() to load data.</p></li>
<li><p><strong>suffix</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – A regular suffix pattern to match scan ids in the data source. For
example, “.1” will find all top level keys in the h5 file that end with “.1”, such as “1.1”, “2.1”, etc.
Defaults to None, in which case no data is loaded on instantiation. (Use load_scan() to load data.)</p></li>
<li><p><strong>scan_motor</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – The path in the h5 file to the motor that is changing with the scan_id.
Only relevant when multiple scan_ids are loaded. Defaults to None.</p></li>
<li><p><strong>roi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – (row_min, row_max, column_min, column_max),
The roi refers to the detector dimensions. I.e for each frame only the part that corresponds to
frame[roi[0]:roi[1], roi[2]:roi[3]] is loaded. Defaults to None, in which case all data is loaded.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">reader</span> <span class="pre">(</span></span></dt>
<dd><p>obj: <cite>darling.reader.Reader</cite>): A file reader implementing, at least, the functionallity
specified in darling.reader.Reader().</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">data</span> <span class="pre">(</span></span></dt>
<dd><p>obj: <cite>numpy.ndarray</cite>): The data array of shape (a,b,m,n,(o)) where a,b are the detector
dimensions and m,n,(o) are the motor dimensions.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">motors</span> <span class="pre">(</span></span></dt>
<dd><p>obj: <cite>numpy.ndarray</cite>): The motor grids of shape (k, m,n,(o)) where k is the number of
motors and m,n,(o) are the motor dimensions.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">h5file</span> <span class="pre">(</span></span></dt>
<dd><p>obj: <cite>string</cite>): The absolute path to the h5 file in which all data resides.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="darling._dataset.DataSet.roi">
<span class="sig-name descname"><span class="pre">roi</span></span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/_dataset.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling._dataset.DataSet.roi" title="Link to this definition">#</a></dt>
<dd><p>(row_min, row_max, column_min, column_max),
The roi refers to the detector dimensions. I.e for each frame only the part that corresponds to
frame[roi[0]:roi[1], roi[2]:roi[3]] is loaded. Defaults to None, in which case all data is loaded.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">verbose</span> <span class="pre">(</span></span></dt>
<dd><p>obj: <cite>bool</cite>): Prints progress on loading. Defaults to False.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="darling._dataset.DataSet.dtype">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dtype</span></span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/_dataset.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling._dataset.DataSet.dtype" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="darling._dataset.DataSet.info">
<span class="sig-name descname"><span class="pre">info</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/_dataset.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling._dataset.DataSet.info" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="darling._dataset.DataSet.scan_params">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">scan_params</span></span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/_dataset.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling._dataset.DataSet.scan_params" title="Link to this definition">#</a></dt>
<dd><p>The scan parameters for the loaded data in a dictionary.</p>
<p>Example output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;scan_command&#39;</span><span class="p">:</span> <span class="s1">&#39;fscan2d chi -0.5 0.08 26 diffry 7 0.06 37 0.5 0.500417&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scan_shape&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">26</span><span class="p">,</span> <span class="mi">37</span><span class="p">],</span>
    <span class="s1">&#39;motor_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;instrument/chi/value&#39;</span><span class="p">,</span> <span class="s1">&#39;instrument/diffry/data&#39;</span><span class="p">],</span>
    <span class="s1">&#39;integrated_motors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="s1">&#39;data_name&#39;</span><span class="p">:</span> <span class="s1">&#39;instrument/pco_ff/image&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scan_id&#39;</span><span class="p">:</span> <span class="s1">&#39;1.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;invariant_motors&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ccmth&#39;</span><span class="p">:</span> <span class="mf">6.679671220242654</span><span class="p">,</span>
        <span class="s1">&#39;s8vg&#39;</span><span class="p">:</span> <span class="mf">0.09999999999999998</span><span class="p">,</span>
        <span class="s1">&#39;s8vo&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;s8ho&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;s8hg&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;mainx&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">5000.0</span><span class="p">,</span>
        <span class="s1">&#39;obx&#39;</span><span class="p">:</span> <span class="mf">263.1299999999999</span><span class="p">,</span>
        <span class="s1">&#39;oby&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;obz&#39;</span><span class="p">:</span> <span class="mf">85.35999999999876</span><span class="p">,</span>
        <span class="s1">&#39;obz3&#39;</span><span class="p">:</span> <span class="mf">0.0693999999999999</span><span class="p">,</span>
        <span class="s1">&#39;obpitch&#39;</span><span class="p">:</span> <span class="mf">17.979400000000002</span><span class="p">,</span>
        <span class="s1">&#39;obyaw&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.06589062499999998</span><span class="p">,</span>
        <span class="s1">&#39;cdx&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">11.8</span><span class="p">,</span>
        <span class="s1">&#39;dcx&#39;</span><span class="p">:</span> <span class="mf">545.0</span><span class="p">,</span>
        <span class="s1">&#39;dcz&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">150.0</span><span class="p">,</span>
        <span class="s1">&#39;ffz&#39;</span><span class="p">:</span> <span class="mf">1621.611386138614</span><span class="p">,</span>
        <span class="s1">&#39;ffy&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;ffsel&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">60.0</span><span class="p">,</span>
        <span class="s1">&#39;x_pixel_size&#39;</span><span class="p">:</span> <span class="mf">6.5</span><span class="p">,</span>
        <span class="s1">&#39;y_pixel_size&#39;</span><span class="p">:</span> <span class="mf">6.5</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The scan parameters.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="darling._dataset.DataSet.sensors">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">sensors</span></span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/_dataset.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling._dataset.DataSet.sensors" title="Link to this definition">#</a></dt>
<dd><p>The sensor data for the loaded data in a dictionary.</p>
<p>this contains things like the pico4 current data that monitors the direct beam current.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The sensor data.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="darling._dataset.DataSet.load_scan">
<span class="sig-name descname"><span class="pre">load_scan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_motor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/_dataset.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling._dataset.DataSet.load_scan" title="Link to this definition">#</a></dt>
<dd><p>Load a scan into RAM.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – scan id or scan ids to load.</p></li>
<li><p><strong>scan_motor</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – path in h5file to the motor that is changing with the scan_id.
Defaults to None. Must be set when scan_id is not a single string.</p></li>
<li><p><strong>roi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – row_min row_max and column_min and column_max,
defaults to None, in which case all data is loaded. The roi refers to the detector
dimensions.</p></li>
<li><p><strong>(</strong> (<em>verbose</em>) – obj: <cite>bool</cite>): Prints progress on loading. Defaults to False.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="darling._dataset.DataSet.subtract">
<span class="sig-name descname"><span class="pre">subtract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">background</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'numpy.uint16'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/_dataset.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling._dataset.DataSet.subtract" title="Link to this definition">#</a></dt>
<dd><p>Subtract a fixed integer value from the data block.</p>
<dl class="simple">
<dt>Warning: If dtype is not np.uint16, data will be cast to dtype, which will create a</dt><dd><p>temporary copy of the data.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>background</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – fixed background value or background array to subtract.
the array will be broadcast to the data block shape. I.e for a shape=(a,b,m,n) data block, the background
could be of detector dimension shape=(a,b) or shape=(a,b,1,1).</p></li>
<li><p><strong>dtype</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.dtype</span></code>) – the data type of the output array. Defaults to np.uint16.
in which case the data is clipped to the range [0, 2^16-1]. protects against uint16
sign flips.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="darling._dataset.DataSet.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/_dataset.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling._dataset.DataSet.save" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-darling.reader">
<span id="reader"></span><h2>reader<a class="headerlink" href="#module-darling.reader" title="Link to this heading">#</a></h2>
<p>Collection of pre-implemneted h5 readers developed for id03 format.</p>
<p>NOTE: In general the file reader is strongly dependent on data collection scheme and it is therefore the
purpose of darling to allow the user to subclass Reader() and implement their own specific data structure.</p>
<p>Once the reader is implemented in darling format it is possible to interface the DataSet class and use
all features of darling.</p>
<dl class="py class">
<dt class="sig sig-object py" id="darling.reader.Reader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">darling.reader.</span></span><span class="sig-name descname"><span class="pre">Reader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">abs_path_to_h5_file</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/reader.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.reader.Reader" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Parent class for readers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>(</strong> (<em>abs_path_to_h5_file</em>) – obj: <cite>str</cite>): Absolute file path to data.</p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">abs_path_to_h5_file</span> <span class="pre">(</span></span></dt>
<dd><p>obj: <cite>str</cite>): Absolute file path to data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="darling.reader.Reader.fetch">
<span class="sig-name descname"><span class="pre">fetch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/reader.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.reader.Reader.fetch" title="Link to this definition">#</a></dt>
<dd><p>Fetch a value from the h5 file.</p>
<p>This is usefull to fetch excotic motor values or meta-data that has not yet been implemented
in the standard darling readers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – The key to fetch from the h5 file. (full h5 path in the h5 file)</p></li>
<li><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – The scan id to fetch from. Defaults to None, in which case the scan id
is taken from the reader.scan_params[“scan_id”].</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The value from the h5 file.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="darling.reader.Reader.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/reader.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.reader.Reader.__call__" title="Link to this definition">#</a></dt>
<dd><p>Method to read a single 2D scan</p>
<dl class="simple">
<dt>NOTE: This method is meant to be purpose implemented to fit the specific data aqusition</dt><dd><p>scheme used.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – scan id to load from, these are internal kayes to diffirentiate
layers.</p></li>
<li><p><strong>roi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – row_min row_max and column_min and column_max,
defaults to None, in which case all data is loaded. The roi refers to the detector
dimensions.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>data (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) of shape=(a,b,m,n) and type np.uint16 and motors
(<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) of shape=(m,) and shape=(n,) and type
np.float32. a,b are detector dimensions while m,n are scan dimensions over
which teh motor settings vary.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="darling.reader.MosaScan">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">darling.reader.</span></span><span class="sig-name descname"><span class="pre">MosaScan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">abs_path_to_h5_file</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/reader.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.reader.MosaScan" title="Link to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="#darling.reader.Reader" title="darling.reader.Reader"><code class="xref py py-class docutils literal notranslate"><span class="pre">Reader</span></code></a></p>
<p>Load a 2D mosa scan. This is a id03 specific implementation matching a specific beamline mosa scan macro.</p>
<p>NOTE: This reader was specifically written for data collection at id03. For general purpose reading of data you
must implement your own reader class. The exact reding of data is strongly dependent on data aqusition scheme and
data structure implementation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>str</strong> (<em>abs_path_to_h5_file</em>) – absolute path to the h5 file with the diffraction images.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="darling.reader.MosaScan.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/reader.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.reader.MosaScan.__call__" title="Link to this definition">#</a></dt>
<dd><p>Load a scan</p>
<p>this loads the mosa data array with shape N,N,m,n where N is the detector dimension and
m,n are the motor dimensions as ordered in the self.motor_names. You may view the implemented darling readers as example templates for implementing
your own reader.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – scan id to load from, e.g 1.1, 2.1 etc…</p></li>
<li><p><strong>roi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – row_min row_max and column_min and column_max,
defaults to None, in which case all data is loaded</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>data of shape=(a,b,m,n) and the</dt><dd><p>motor arrays as 2d meshgrids, shape=(k,m,n)
where k is the number of motors used in the
scan (typically 1,2 or 3).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data, motors</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="darling.reader.Darks">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">darling.reader.</span></span><span class="sig-name descname"><span class="pre">Darks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">abs_path_to_h5_file</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/reader.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.reader.Darks" title="Link to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="#darling.reader.MosaScan" title="darling.reader.MosaScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">MosaScan</span></code></a></p>
<p>Load a series of motorless images. This is a id03 specific implementation matching a specific beamline macro.</p>
<p>Typically used to red dark images collected with a loopscan.</p>
<p>NOTE: This reader was specifically written for data collection at id03. For general purpose reading of data you
must implement your own reader class. The exact reding of data is strongly dependent on data aqusition scheme and
data structure implementation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>str</strong> (<em>abs_path_to_h5_file</em>) – absolute path to the h5 file with the diffraction images.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="darling.reader.Darks.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/reader.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.reader.Darks.__call__" title="Link to this definition">#</a></dt>
<dd><p>Load a scan</p>
<p>this loads the static scan data array with shape a,b,m where a,b are the detector dimensions and
m is the number of (motorless) images. You may view the implemented darling readers as example templates
for implementing your own reader.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – scan id to load from, e.g 1.1, 2.1 etc…</p></li>
<li><p><strong>roi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – row_min row_max and column_min and column_max,
defaults to None, in which case all data is loaded</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>data of shape=(a,b,m) and an empty motor array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data, motors</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="darling.reader.RockingScan">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">darling.reader.</span></span><span class="sig-name descname"><span class="pre">RockingScan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">abs_path_to_h5_file</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/reader.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.reader.RockingScan" title="Link to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="#darling.reader.MosaScan" title="darling.reader.MosaScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">MosaScan</span></code></a></p>
<p>Load a 1D rocking scan. This is a id03 specific implementation matching a specific beamline macro.</p>
<p>A rocking scan is simply a set of 2D detector images collected at different rocking angles of the goniometer.</p>
<p>NOTE: This reader was specifically written for data collection at id03. For general purpose reading of data you
must implement your own reader class. The exact reding of data is strongly dependent on data aqusition scheme and
data structure implementation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>str</strong> (<em>abs_path_to_h5_file</em>) – absolute path to the h5 file with the diffraction images.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="darling.reader.RockingScan.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/reader.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.reader.RockingScan.__call__" title="Link to this definition">#</a></dt>
<dd><p>Load a scan</p>
<p>this loads the rocking scan data array with shape a,b,m where a,b are the detector dimensions and
m is the motor dimensions. You may view the implemented darling readers as example templates
for implementing your own reader.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – scan id to load from, e.g 1.1, 2.1 etc…</p></li>
<li><p><strong>roi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – row_min row_max and column_min and column_max,
defaults to None, in which case all data is loaded</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>data of shape=(a,b,m) and the</dt><dd><p>motor arrays as an array of shape=(k, n)
where k is the number of motors used in the
scan (i.e k=1 for a rocking scan).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data, motors</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-darling.assets">
<span id="assets"></span><h2>assets<a class="headerlink" href="#module-darling.assets" title="Link to this heading">#</a></h2>
<p>Module to load example data and phantoms.</p>
<dl class="py function">
<dt class="sig sig-object py" id="darling.assets.path">
<span class="sig-prename descclassname"><span class="pre">darling.assets.</span></span><span class="sig-name descname"><span class="pre">path</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/assets.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.assets.path" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.assets.mosa_field">
<span class="sig-prename descclassname"><span class="pre">darling.assets.</span></span><span class="sig-name descname"><span class="pre">mosa_field</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/assets.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.assets.mosa_field" title="Link to this definition">#</a></dt>
<dd><p>Load a 2D numpy array of a mosaicity field.</p>
<p>mosa[…, 0] is the chi angle.
mosa[…, 1] is the mu angle.</p>
<p>data originates from the 1 -1 1 reflection of a 5% deformed Al1050 sample.</p>
<p>ESRF ID03, experiment hc6042.
dataset : Al_1050_strengthening_strainmosa_stregnthening_pct5_large_range
Scan number : 5.1.
Analysis: background subtraction, and a first maxima gaussian fitting.</p>
<p>mean omega angle was 17.8345 and mean chi angle was 0.60997 the crystal to
sample grain orientation matrix was measured to be :</p>
<blockquote>
<div><p>[0.83550027,  0.33932153, -0.43220389]
[0.01167249,  0.77541728,  0.63134127]
[0.54936605, -0.53253069,  0.64390062]</p>
</div></blockquote>
<p>from 3DXRD. The sample is in tensile strain with the grain 1-11 aling the
tensile axis wich is identified as the lab-z axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>2D array of shape=(m, n) with mosaicity values.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>mosa (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.assets.domains">
<span class="sig-prename descclassname"><span class="pre">darling.assets.</span></span><span class="sig-name descname"><span class="pre">domains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'1.1'</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/assets.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.assets.domains" title="Link to this definition">#</a></dt>
<dd><p>load a (tiny) part of a 2d mosaicity scan collected at the ESRF id03.</p>
<p>in constrast to mosaicity_scan() this dataset features a domain structure
partioned into cells.</p>
<p>NOTE: due to the domain partitioning this dataset has been inlcuded in the darling
assets for unit testing various domain related feature extarction methods such as
gaussian fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – one of 1.1 or 2.1, specifying first or second layer scanned in the sample.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>absolute path to h5 file.
data (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>):  Array of shape=(a, b, m, n) with intensity data.
<code class="docutils literal notranslate"><span class="pre">data[:,:,i,j]</span></code> is a noisy detector image in type uint16 for phi and
chi at index i and j respectively.
coordinates (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>): array of shape=(2,m,n) continaning
angle coordinates.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data_path (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.assets.rocking_scan">
<span class="sig-prename descclassname"><span class="pre">darling.assets.</span></span><span class="sig-name descname"><span class="pre">rocking_scan</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/assets.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.assets.rocking_scan" title="Link to this definition">#</a></dt>
<dd><p>load a downsampled 1d rocking scan collected at the ESRF id03.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>absolute path to h5 file.
data (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>):  Array of shape=(a, b, m, n) with intensity data. <code class="docutils literal notranslate"><span class="pre">data[:,:,i,j]</span></code>
is a noisy detector image in type uint16 for phi and chi at index i and j respectively.
coordinates (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>): array of shape=(2,m,n) continaning angle coordinates.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>data_path (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.assets.motor_drift">
<span class="sig-prename descclassname"><span class="pre">darling.assets.</span></span><span class="sig-name descname"><span class="pre">motor_drift</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'1.1'</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/assets.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.assets.motor_drift" title="Link to this definition">#</a></dt>
<dd><p>load a (tiny) part of a 2d mosaicity scan collected at the ESRF id03.</p>
<p>NOTE: This dataset features motor drift and has been inlcuded in the darling
assets for unit testing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – one of 1.1 or 2.1, specifying first or second layer scanned in the sample.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>absolute path to h5 file.
data (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>):  Array of shape=(a, b, m, n) with intensity data. <code class="docutils literal notranslate"><span class="pre">data[:,:,i,j]</span></code> is a
noisy detector image in type uint16 for phi and chi at index i and j respectively.
coordinates (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>): array of shape=(2,m,n) continaning angle coordinates.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data_path (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.assets.mosaicity_scan">
<span class="sig-prename descclassname"><span class="pre">darling.assets.</span></span><span class="sig-name descname"><span class="pre">mosaicity_scan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'1.1'</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/assets.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.assets.mosaicity_scan" title="Link to this definition">#</a></dt>
<dd><p>Load a (tiny) part of a 2D mosaicity scan collected at the ESRF ID03.</p>
<p>This is a central detector ROI for a 111 reflection in a 5% deformed Aluminium. Two layers
are available with scan_id 1.1 and 2.1.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – One of 1.1 or 2.1, specifying first or second layer scanned in the sample.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Absolute path to h5 file.
data (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>): Array of shape (a, b, m, n) with intensity data.
<code class="docutils literal notranslate"><span class="pre">data[:,:,i,j]</span></code> is a noisy detector image (uint16) for phi and chi at index <code class="docutils literal notranslate"><span class="pre">i,</span> <span class="pre">j</span></code>.
coordinates (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>): Array of shape (2, m, n) containing angle coordinates.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data_path (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.assets.energy_mu_scan">
<span class="sig-prename descclassname"><span class="pre">darling.assets.</span></span><span class="sig-name descname"><span class="pre">energy_mu_scan</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/assets.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.assets.energy_mu_scan" title="Link to this definition">#</a></dt>
<dd><p>Load a (tiny) part of a 2D ccmth-mu scan collected at the ESRF ID03.</p>
<p>This is a central detector ROI for a BiFeO3 energy scan with a small slit inserted in the
backfocal plane. The scan is performed with the ccmth motor (i.e the monochromator) and the
mu motor (i.e the base cradle/rocking cradle).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – Must be ‘1.1’. Only one scan is available.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Absolute path to h5 file.
data (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>): Array of shape (a, b, m, n) with intensity data.
<code class="docutils literal notranslate"><span class="pre">data[:,:,i,j]</span></code> is a noisy detector image (uint16) for ccmth and mu at index <code class="docutils literal notranslate"><span class="pre">i,</span> <span class="pre">j</span></code>.
coordinates (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>): Array of shape (2, m, n) containing angle coordinates.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data_path (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.assets.energy_mosa_scan">
<span class="sig-prename descclassname"><span class="pre">darling.assets.</span></span><span class="sig-name descname"><span class="pre">energy_mosa_scan</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/assets.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.assets.energy_mosa_scan" title="Link to this definition">#</a></dt>
<dd><p>Load a (tiny) part of a 3D strain-mosaicity scan collected at the ESRF ID03.</p>
<p>This is the central detector ROI for a Al1050 crystal.</p>
<p>The scan is performed with the ccmth motor (i.e the monochromator) and the
mu and chi motors (i.e the base cradle/rocking cradle and rolling top stage).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Absolute path to h5 file.
data (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>): Array of shape (a, b, m, n) with intensity data.
<code class="docutils literal notranslate"><span class="pre">data[:,:,i,j]</span></code> is a noisy detector image (uint16) for ccmth and mu at index <code class="docutils literal notranslate"><span class="pre">i,</span> <span class="pre">j</span></code>.
coordinates (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>): Array of shape (2, m, n) containing angle coordinates.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>data_path (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.assets.gaussian_blobs">
<span class="sig-prename descclassname"><span class="pre">darling.assets.</span></span><span class="sig-name descname"><span class="pre">gaussian_blobs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">9</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/assets.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.assets.gaussian_blobs" title="Link to this definition">#</a></dt>
<dd><p>Phantom 2d scan of gaussian blobs with shifting means and covariance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>N</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – Desired data array size which is of shape=(N,N,m,m).</p></li>
<li><p><strong>m</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – Desired data array size which is of shape=(N,N,m,m).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array of shape=(N, N, m, m) with intensity data, <code class="docutils literal notranslate"><span class="pre">data[:,:,i,j]</span></code>
is a noisy detector image in type uint16 for motor x and y at index i and j respectively.
coordinates (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>): array of shape=(2,m,m) continaning x and y coordinates.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>)</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-darling.filters">
<span id="filters"></span><h2>filters<a class="headerlink" href="#module-darling.filters" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="darling.filters.snr_threshold">
<span class="sig-prename descclassname"><span class="pre">darling.filters.</span></span><span class="sig-name descname"><span class="pre">snr_threshold</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">primary_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">secondary_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop_outer_dims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/filters.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.filters.snr_threshold" title="Link to this definition">#</a></dt>
<dd><p>Threshold data based on a local signal-to-noise ratio (SNR) criterion.</p>
<p>Each data bin is classified using a Gaussian noise model defined by the
input mean and sigma. The signal-to-noise ratio (SNR) is defined as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SNR</span> <span class="o">=</span> <span class="p">(</span><span class="n">local_value</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
</pre></div>
</div>
<p>Thresholding rules:</p>
<blockquote>
<div><dl class="simple">
<dt>SNR &gt; primary_threshold</dt><dd><p>Always kept.</p>
</dd>
<dt>SNR &lt;= secondary_threshold</dt><dd><p>Always set to zero.</p>
</dd>
<dt>secondary_threshold &lt; SNR &lt;= primary_threshold</dt><dd><p>Kept only if at least one immediate neighbour has
SNR &gt; primary_threshold.
Neighbourhood sizes are 3, 9 and 27 in 1D, 2D and 3D respectively.</p>
</dd>
</dl>
</div></blockquote>
<p>Dimensionality handling:</p>
<blockquote>
<div><p>When <code class="docutils literal notranslate"><span class="pre">loop_outer_dims=True</span></code> (default), the first two dimensions of
the data array are treated as outer dimensions (detector rows and
columns). Thresholding is applied independently and in parallel to
each trailing block.</p>
<blockquote>
<div><dl class="simple">
<dt>Supported shapes:</dt><dd><p>shape=(a, b, m)
shape=(a, b, m, n)
shape=(a, b, m, n, o)</p>
</dd>
</dl>
<p>In this case, mean and sigma must be arrays of shape=(a, b).</p>
</div></blockquote>
<p>When <code class="docutils literal notranslate"><span class="pre">loop_outer_dims=False</span></code>, thresholding is applied directly to
the data array:</p>
<blockquote>
<div><dl class="simple">
<dt>Supported shapes:</dt><dd><p>shape=(m,)
shape=(m, n)
shape=(m, n, o)</p>
</dd>
</dl>
<p>In this case, mean and sigma must be scalars.</p>
</div></blockquote>
</div></blockquote>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">darling</span>

<span class="n">_</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">motors</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">mosaicity_scan</span><span class="p">()</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="n">mean</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="n">primary_threshold</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">secondary_threshold</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">filtered_data</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">snr_threshold</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">mean</span><span class="p">,</span>
    <span class="n">sigma</span><span class="p">,</span>
    <span class="n">primary_threshold</span><span class="p">,</span>
    <span class="n">secondary_threshold</span><span class="p">,</span>
    <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">loop_outer_dims</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">36</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Raw Data at pixel (20, 10)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.054</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">36</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;SNR Filtered Data at pixel (20, 10) &quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="c1"># annotate the  primary threshold</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Primary Threshold: SNR &gt;= </span><span class="si">{</span><span class="n">primary_threshold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># annotate the secondary threshold</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Secondary Threshold: SNR &gt;= </span><span class="si">{</span><span class="n">secondary_threshold</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.054</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">spine</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/snr.png" src="_images/snr.png" />
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Input data array to threshold.</p></li>
<li><p><strong>mean</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Mean of the local Gaussian noise model.</p></li>
<li><p><strong>sigma</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Standard deviation of the local Gaussian noise model.</p></li>
<li><p><strong>primary_threshold</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – Primary SNR threshold. Must be greater than zero.</p></li>
<li><p><strong>secondary_threshold</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>, optional) – Secondary SNR threshold. Defaults to None, in which case only
the primary threshold is applied and no neighbour check is
performed. Must be less than the primary threshold.</p></li>
<li><p><strong>copy</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) – Whether to return a thresholded copy of the data. Defaults to False.</p></li>
<li><p><strong>loop_outer_dims</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) – Whether to loop over the outer dimensions (a, b). Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The thresholded data (may be a copy or a view depending on <code class="docutils literal notranslate"><span class="pre">copy</span></code>).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.filters.gaussian_filter">
<span class="sig-prename descclassname"><span class="pre">darling.filters.</span></span><span class="sig-name descname"><span class="pre">gaussian_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">truncate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop_outer_dims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/filters.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.filters.gaussian_filter" title="Link to this definition">#</a></dt>
<dd><p>Apply a separable, intensity-preserving Gaussian filter to a data array.</p>
<p>The filter is implemented as a separable convolution with 1D Gaussian kernels
along the requested trailing axes. The 1D Gaussian kernel is defined as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>A discrete kernel of width <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">radius</span> <span class="pre">+</span> <span class="pre">1</span></code> is constructed for each filtered
axis and normalised to sum to 1 (intensity preserving). Convolution is performed
with zero padding at the boundaries (samples outside the array are treated as 0).</p>
<p>Dimensionality handling:</p>
<blockquote>
<div><p>When <code class="docutils literal notranslate"><span class="pre">loop_outer_dims=True</span></code> (default), the first two dimensions of the data
array are treated as outer dimensions (detector rows and columns). The filter
is applied independently and in parallel to each trailing block.</p>
<blockquote>
<div><dl class="simple">
<dt>Supported shapes:</dt><dd><p>shape=(a, b, m)
shape=(a, b, m, n)
shape=(a, b, m, n, o)</p>
</dd>
</dl>
</div></blockquote>
<p>When <code class="docutils literal notranslate"><span class="pre">loop_outer_dims=False</span></code>, the filter is applied directly to the data array:</p>
<blockquote>
<div><dl class="simple">
<dt>Supported shapes:</dt><dd><p>shape=(m,)
shape=(m, n)
shape=(m, n, o)</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">axis</span></code> argument always refers to the trailing dimensions only (never the
outer (a, b) dimensions). For example, for <code class="docutils literal notranslate"><span class="pre">shape=(a,</span> <span class="pre">b,</span> <span class="pre">m,</span> <span class="pre">n,</span> <span class="pre">o)</span></code>, the valid
axis values refer to (m, n, o), i.e. <code class="docutils literal notranslate"><span class="pre">axis=(0,</span> <span class="pre">1,</span> <span class="pre">2)</span></code> or equivalently
<code class="docutils literal notranslate"><span class="pre">axis=(-3,</span> <span class="pre">-2,</span> <span class="pre">-1)</span></code>.</p>
<p>Kernel size:</p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">radius</span></code> is None, the radius is inferred per filtered axis as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">radius</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">truncate</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting kernel width is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">radius</span> <span class="pre">+</span> <span class="pre">1</span></code>. Larger sigma or radius
produces stronger smoothing.</p>
</div></blockquote>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">darling</span>

<span class="n">_</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">motors</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">mosaicity_scan</span><span class="p">()</span>

<span class="n">filtered_data</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">loop_outer_dims</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">36</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">140</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Raw Data at pixel (20, 10)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.0425</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">36</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">140</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Filtered Data at pixel (20, 10) &quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.0425</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">spine</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/gaussian_filter.png" src="_images/gaussian_filter.png" />
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – The data to filter. Must be one of shape=(a, b, m, n, o),
shape=(a, b, m, n) or shape=(a, b, m) when <code class="docutils literal notranslate"><span class="pre">loop_outer_dims</span></code> is True.
When <code class="docutils literal notranslate"><span class="pre">loop_outer_dims</span></code> is False, the data array must be one of
shape=(m, n, o), shape=(m, n) or shape=(m,).</p></li>
<li><p><strong>sigma</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code>) – Standard deviation(s) of the Gaussian kernel. If a scalar, the same
sigma is used for all trailing dimensions. If a tuple, it must have
the same length as <code class="docutils literal notranslate"><span class="pre">axis</span></code> (when axis is provided), and each filtered
axis uses its corresponding sigma value.</p></li>
<li><p><strong>truncate</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>, optional) – Truncation in units of sigma used to infer the radius when <code class="docutils literal notranslate"><span class="pre">radius</span></code> is
not provided. Defaults to 4.0.</p></li>
<li><p><strong>radius</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code>, optional) – Kernel radius/radii. If provided, the kernel width is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">radius</span> <span class="pre">+</span> <span class="pre">1</span></code>.
If a tuple, it must have the same length as <code class="docutils literal notranslate"><span class="pre">axis</span></code> (when axis is
provided). Defaults to None (infer from <code class="docutils literal notranslate"><span class="pre">truncate</span></code> and <code class="docutils literal notranslate"><span class="pre">sigma</span></code>).</p></li>
<li><p><strong>axis</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code>, optional) – Trailing axis/axes to filter. Defaults to None, in which case all trailing
dimensions are filtered. Axis values may be negative and are interpreted
relative to the trailing block (not the full array when <code class="docutils literal notranslate"><span class="pre">loop_outer_dims</span></code>
is True).</p></li>
<li><p><strong>copy</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) – Whether to return a filtered copy of the data. Defaults to False, in which
case the input array is modified in place.</p></li>
<li><p><strong>loop_outer_dims</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) – Whether to loop over the outer dimensions (a, b) and filter each trailing
block independently. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The filtered data (may be a copy or a view depending on <code class="docutils literal notranslate"><span class="pre">copy</span></code>).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-darling.properties">
<span id="properties"></span><h2>properties<a class="headerlink" href="#module-darling.properties" title="Link to this heading">#</a></h2>
<p>Functions module for computation of data features over 4D or 5D fields. I.e computation of moments of
mosa-scans strain-mosa-scans and the like.</p>
<p>As an example, in a DFXM strain-mosaicity-scan setting, using random arrays, the 3D moments
in theta, phi and chi can be retrieved as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">darling</span>

<span class="c1"># create coordinate arrays</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># crl scan grid</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># motor rocking scan grid</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="c1"># motor rolling scan grid</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">))</span>

<span class="c1"># create a random data array</span>
<span class="n">detector_dim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span> <span class="c1"># the number of rows and columns of the detector</span>
<span class="n">data</span> <span class="o">=</span> <span class="mi">64000</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">detector_dim</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">chi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

<span class="c1"># compute the first and second moments such that</span>
<span class="c1"># mean[i,j] is the shape=(3,) array of mean coorindates for pixel i,j.</span>
<span class="c1"># covariance[i,j] is the shape=(3,3) covariance matrix of pixel i,j.</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">covariance</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">mean</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">covariance</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="darling.properties.rgb">
<span class="sig-prename descclassname"><span class="pre">darling.properties.</span></span><span class="sig-name descname"><span class="pre">rgb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">property_2d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'dynamic'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinates</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/properties.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.properties.rgb" title="Link to this definition">#</a></dt>
<dd><p>Compute a m, n, 3 rgb array from a 2d property map, e.g from a first moment map.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">darling</span>

<span class="c1"># create some phantom data</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<span class="n">property_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">chi</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">property_2d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">chi</span><span class="p">))</span>
<span class="n">property_2d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">chi</span><span class="p">))</span>

<span class="c1"># compute the rgb map normalising to the coordinates array</span>
<span class="n">rgb_map</span><span class="p">,</span> <span class="n">colorkey</span><span class="p">,</span> <span class="n">colorgrid</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">property_2d</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">coord</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;dark_background&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgb_map</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/rgbmapfull.png" src="_images/rgbmapfull.png" />
<p>alternatively; normalize to the dynamic range of the property_2d array</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rgb_map</span><span class="p">,</span> <span class="n">colorkey</span><span class="p">,</span> <span class="n">colorgrid</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">property_2d</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;dark_background&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgb_map</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/rgbmapdynamic.png" src="_images/rgbmapdynamic.png" />
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>property_2d</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – The property map to colorize, shape=(a, b, 2),
the last two dimensions will be mapped to rgb colors.</p></li>
<li><p><strong>coordinates</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – Coordinate grid assocated to the
property map, shape=(m, n), optional for norm=”full”. Defaults to None.</p></li>
<li><p><strong>norm</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – array of shape=(2, 2) of the normalization
range of the colormapping. Defaults to ‘dynamic’, in which case the range is computed
from the property_2d array max and min.
(norm[i,0] is min value for property_2d[:,:,i] and norm[i,1] is max value
for property_2d[:,:,i].). If the string ‘full’ is passed, the range is
computed from the coordinates as the max and min of the coordinates. This
requires the coordinates to be passed as well.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>RGB map of shape=(a, b, 3) and</dt><dd><p>the colorkey of shape (m, n, 3) and the grid of the colorkey
of shape=(m, n).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.properties.kam">
<span class="sig-prename descclassname"><span class="pre">darling.properties.</span></span><span class="sig-name descname"><span class="pre">kam</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">property_2d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(3,</span> <span class="pre">3)</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/properties.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.properties.kam" title="Link to this definition">#</a></dt>
<dd><p>Compute the KAM (Kernel Average Misorientation) map of a 2D property map.</p>
<p>KAM is computed by sliding a kernel across the image and for each voxel computing
the average misorientation between the central voxel and the surrounding voxels.
Here the misorientation is defined as the L2 euclidean distance between the
(potentially vectorial) property map and the central voxel such that scalars formed
as for instance np.linalg.norm( property_2d[i + 1, j] - property_2d[i, j] ) are
computed and averaged over the kernel.</p>
<p>NOTE: This is a projected KAM in the sense that the rotation the full rotation
matrix of the voxels are unknown. I.e this is a computation of the misorientation
between diffraction vectors Q and not orientation elements of SO(3). For 1D rocking
scans this is further reduced due to the fact that the roling angle is unknown.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter</span>

<span class="kn">import</span> <span class="nn">darling</span>

<span class="c1"># create some phantom data</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<span class="n">property_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">chi</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">property_2d</span><span class="p">[</span><span class="n">property_2d</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">property_2d</span> <span class="o">-=</span> <span class="mf">0.5</span>
<span class="n">property_2d</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">property_2d</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># compute the KAM map</span>
<span class="n">kam</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">kam</span><span class="p">(</span><span class="n">property_2d</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;dark_background&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">kam</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;plasma&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/kam.png" src="_images/kam.png" />
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>property_2d</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – The property map to compute the KAM from,
shape=(a, b, m) or (a, b). This is assumed to be the angular coordinates of
diffraction such that np.linalg.norm( property_2d[i,j]) gives the mismatch
in degrees between the reference diffraction vector and the local mean
diffraction vector.</p></li>
<li><p><strong>size</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code>) – The size of the kernel to use for the KAM computation.
Defaults to (3, 3).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The KAM map of shape=(a, b). (same units as input.)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.properties.moments">
<span class="sig-prename descclassname"><span class="pre">darling.properties.</span></span><span class="sig-name descname"><span class="pre">moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinates</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/properties.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.properties.moments" title="Link to this definition">#</a></dt>
<dd><p>Compute the sample mean amd covariance of a 3D, 4D or 5D DFXM data-set.</p>
<p>The data-set represents a DFXM scan with 1, 2 or 3 degrees of freedom.
These could be mu, phi and chi, or phi and energy, etc. The total data array
is therefore either 3d, 4d or 5d.</p>
<dl class="simple">
<dt>NOTE: Computation is done in parallel using shared memory with numba just</dt><dd><p>in time compiling.</p>
</dd>
</dl>
<p>Example in a DFXM mosaicity-scan setting using random arrays:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">darling</span>

<span class="c1"># create coordinate arrays</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">))</span>

<span class="c1"># create a random data array</span>
<span class="n">detector_dim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="mi">64000</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">detector_dim</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">chi</span><span class="p">))</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>

<span class="c1"># compute the first and second moments</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">covariance</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – Array of shape=(a, b, m) or shape=(a, b, m, n)
or shape=(a, b, m, n, o) where the maps over which the mean will be
calculated are of shape=(m) or shape=(m, n) or shape=(m, n, o) respectively
and the detector field dimensions are of shape=(a, b).
I.e data[i, j, …] is a distribution for pixel i, j.</p></li>
<li><p><strong>coordinates</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – numpy nd arrays specifying the coordinates in each dimension
respectively. I.e, as an example, these could be the phi and chi angular
cooridnates as a meshgrid. Shape=(ndim, m, n, …). where ndim=1 for a rocking scan,
ndim=2 for a mosaicity scan, etc.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>The mean map of shape=(a,b,…) and the</dt><dd><p>covariance map of shape=(a,b,…).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.properties.mean">
<span class="sig-prename descclassname"><span class="pre">darling.properties.</span></span><span class="sig-name descname"><span class="pre">mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinates</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/properties.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.properties.mean" title="Link to this definition">#</a></dt>
<dd><p>Compute the sample mean of a 3D, 4D or 5D DFXM data-set.</p>
<p>The data-set represents a DFXM scan with 1, 2 or 3 degrees of freedom.
These could be mu, phi and chi, or phi and energy, etc. The total data array
is therefore either 3d, 4d or 5d.</p>
<dl class="simple">
<dt>NOTE: Computation is done in parallel using shared memory with numba just</dt><dd><p>in time compiling.</p>
</dd>
</dl>
<p>Example in a DFXM energy-mosaicity-scan setting using random arrays:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">darling</span>

<span class="c1"># create coordinate arrays</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">))</span>

<span class="c1"># create a random data array</span>
<span class="n">detector_dim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="mi">64000</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">detector_dim</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">chi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>

<span class="c1"># compute the first moments</span>
<span class="n">first_moment</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – Array of shape=(a, b, m) or shape=(a, b, m, n)
or shape=(a, b, m, n, o) where the maps over which the mean will be
calculated are of shape=(m) or shape=(m, n) or shape=(m, n, o) respectively
and the detector field dimensions are of shape=(a, b).
I.e data[i, j, …] is a distribution for pixel i, j.</p></li>
<li><p><strong>coordinates</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – numpy nd arrays specifying the coordinates in each dimension
respectively. I.e, as an example, these could be the phi and chi angular
cooridnates as a meshgrid. Shape=(ndim, m, n, …). where ndim=1 for a rocking scan,
ndim=2 for a mosaicity scan, etc.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The mean map of shape=(a,b,k) where k=data.ndim - 2.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.properties.covariance">
<span class="sig-prename descclassname"><span class="pre">darling.properties.</span></span><span class="sig-name descname"><span class="pre">covariance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_moments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/properties.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.properties.covariance" title="Link to this definition">#</a></dt>
<dd><p>Compute the sample mean of a 3D, 4D or 5D DFXM data-set.</p>
<p>The data-set represents a DFXM scan with 1, 2 or 3 degrees of freedom.
These could be mu, phi and chi, or phi and energy, etc. The total data array
is therefore either 3d, 4d or 5d.</p>
<dl class="simple">
<dt>NOTE: Computation is done in parallel using shared memory with numba just</dt><dd><p>in time compiling.</p>
</dd>
</dl>
<p>Example in a DFXM energy-mosaicity-scan setting using random arrays:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">darling</span>

<span class="c1"># create coordinate arrays</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">))</span>

<span class="c1"># create a random data array</span>
<span class="n">detector_dim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="mi">64000</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">detector_dim</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">chi</span><span class="p">))</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>

<span class="c1"># compute the first moments</span>
<span class="n">first_moment</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>

<span class="c1"># compute the second moments</span>
<span class="n">covariance</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">covariance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">first_moments</span><span class="o">=</span><span class="n">first_moment</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – Array of shape=(a, b, m) or shape=(a, b, m, n)
or shape=(a, b, m, n, o) where the maps over which the mean will be
calculated are of shape=(m) or shape=(m, n) or shape=(m, n, o) respectively
and the detector field dimensions are of shape=(a, b).
I.e data[i, j, …] is a distribution for pixel i, j.</p></li>
<li><p><strong>coordinates</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – numpy nd arrays specifying the coordinates in each dimension
respectively. I.e, as an example, these could be the phi and chi angular
cooridnates as a meshgrid. Shape=(ndim, m, n, …). where ndim=1 for a rocking scan,
ndim=2 for a mosaicity scan, etc.</p></li>
<li><p><strong>first_moments</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – Array of shape=(a, b, …) of the first
moments as described in darling.properties.mean(). Defaults to None, in
which case the first moments are recomputed on the fly.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The covariance map of shape=(a,b,…).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.properties.fit_1d_gaussian">
<span class="sig-prename descclassname"><span class="pre">darling.properties.</span></span><span class="sig-name descname"><span class="pre">fit_1d_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">number_of_gauss_newton_iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/properties.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.properties.fit_1d_gaussian" title="Link to this definition">#</a></dt>
<dd><p>Fit analytical gaussian + linear background for each pixel in a 2D image.</p>
<p>The input volume is assumed to have shape (ny, nx, m), where the
last axis corresponds to the 1D curves to be fitted with
a Gaussian + linear background. For each data[i, j, :] the function fits</p>
<p>f(x) = A * exp(-(x - mu)**2 / (2 * sigma**2)) + k * x + m</p>
<p>and stores the five fitted parameters: [A, mu, sigma, k, m, success].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – 3D array of shape (ny, nx, m). Arbitrary dtypes are supported.</p></li>
<li><p><strong>coordinates</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – numpy nd arrays specifying the coordinates in each dimension
respectively. I.e, as an example, these could be the phi and chi angular
cooridnates as a meshgrid. Shape=(ndim, m, n, …). where ndim=1 for a rocking scan,
ndim=2 for a mosaicity scan, etc.</p></li>
<li><p><strong>number_of_gauss_newton_iterations</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – Number of Gauss-Newton iterations to use for the fit. Defaults to 7.</p></li>
<li><p><strong>mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – 2D array of shape (ny, nx) with dtype bool. Defaults to None. If provided, only the pixels where mask is True will be fitted.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Output array of shape (ny, nx, 5) of dtype float64 with</dt><dd><p>parameters [A, mu, sigma, k, m, success] for each (i, j).
Here A is the amplitude, mu is the mean, sigma is the standard deviation
of the Gaussian, k is the background slope, m is the background intercept,
and success is 0 if the fit failed, 1 if it succeeded.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.properties.gaussian_mixture">
<span class="sig-prename descclassname"><span class="pre">darling.properties.</span></span><span class="sig-name descname"><span class="pre">gaussian_mixture</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinates</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/properties.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.properties.gaussian_mixture" title="Link to this definition">#</a></dt>
<dd><p>Model a 2D grid of 2D images with a 2D grid of gaussian mixtures.</p>
<p>For a data array of shape (m, n, a, b), each primary pixel (i, j) contains a
(a, b) sub-array that is analyzed as a 2D image. Local maxima are identified
within this sub-array, and segmentation is performed to assign a label to
each secondary pixel.</p>
<p>Each segmented region is treated as a Gaussian, with mean and covariance
extracted for each label. Additionally, a set of features is computed
for each label.</p>
<p>Specifically, for each located peak, the following features are extracted:</p>
<ul class="simple">
<li><p><strong>sum_intensity</strong>: Sum of the intensity values in the segmented domain.</p></li>
<li><p><strong>number_of_pixels</strong>: Number of pixels in the segmented domain.</p></li>
<li><p><strong>mean_row</strong>: Mean row position in the segmented domain.</p></li>
<li><p><strong>mean_col</strong>: Mean column position in the segmented domain.</p></li>
<li><p><strong>var_row</strong>: Variance of the row positions in the segmented domain.</p></li>
<li><p><strong>var_col</strong>: Variance of the column positions in the segmented domain.</p></li>
<li><p><strong>var_row_col</strong>: Covariance of the row and column positions in the segmented domain.</p></li>
<li><p><strong>max_pix_row</strong>: Row position of the pixel with the highest intensity.</p></li>
<li><p><strong>max_pix_col</strong>: Column position of the pixel with the highest intensity.</p></li>
<li><p><strong>max_pix_intensity</strong>: Intensity of the pixel with the highest intensity.</p></li>
</ul>
<p>Additionally, when motor coordinate arrays are provided, the following features are included:</p>
<ul class="simple">
<li><p><strong>mean_motor1</strong>: Mean motor position for the first motor.</p></li>
<li><p><strong>mean_motor2</strong>: Mean motor position for the second motor.</p></li>
<li><p><strong>var_motor1</strong>: Variance of the motor positions for the first motor.</p></li>
<li><p><strong>var_motor2</strong>: Variance of the motor positions for the second motor.</p></li>
<li><p><strong>var_motor1_motor2</strong>: Covariance of the motor positions for the first and second motor.</p></li>
<li><p><strong>max_pix_motor1</strong>: Motor position for the first motor of the pixel with the highest intensity.</p></li>
<li><p><strong>max_pix_motor2</strong>: Motor position for the second motor of the pixel with the highest intensity.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">darling</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># import a small data set from assets known to</span>
<span class="c1"># comprise crystalline domains</span>
<span class="n">_</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">coordinates</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">domains</span><span class="p">()</span>

<span class="c1"># compute all the gaussian mixture model features</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">gaussian_mixture</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">)</span>

<span class="c1"># this is a dict like structure that can be accessed like this:</span>
<span class="n">sum_intensity_second_strongest_peak</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;sum_intensity&quot;</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># plot the mean in the first motor direction for the strongest peak</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;dark_background&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;mean_motor1&quot;</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;plasma&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/domains.png" src="_images/domains.png" />
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – Array of shape=(a, b, m, n) or shape=(a, b, m)
where the maps over which the mean will be calculated are of shape=(m, n)
or shape=(m,) and the field is of shape=(a, b) such that data[i, j, :, :] or
data[i, j, :] is a 2D or 1D intensity distribution for pixel i,j.</p></li>
<li><p><strong>k</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – The number of gaussians to fit to the data. Defaults to 8.
this means that the k strongest peaks, with respect to intensity, will be
fitted with gaussians. The remaining peaks will be ignored.</p></li>
<li><p><strong>coordinates</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – array specifying the coordinates of
shape=(2, m, n) or shape=(1, m). I.e, as an example, these could be the
phi and chi angular coordinates or the mu rocking angle.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>features as a dictionary containing the extracted features for</dt><dd><p>each peak with keys as specified above. i.e features[“sum_intensity”][…, i]
is a 2D image where each pixel holds the summed intensity of the i-th
strongest peak. Likewise features[“mean_row”][…, i] is the mean row
position of the i-th strongest peak etc.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-darling.transforms">
<span id="transforms"></span><h2>transforms<a class="headerlink" href="#module-darling.transforms" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.get_lattice_spacing">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">get_lattice_spacing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unit_cell</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hkl</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.get_lattice_spacing" title="Link to this definition">#</a></dt>
<dd><p>Get the lattice spacing for a given unit cell and hkl.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.ccmth_to_strain">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">ccmth_to_strain</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ccmth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unit_cell</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hkl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference_bragg_angle</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.ccmth_to_strain" title="Link to this definition">#</a></dt>
<dd><p>Convert monochromator position (ccmth) to strain given a reference unit cell parameter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ccmth</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – The ccmth in degrees. shape=(n,) or float.</p></li>
<li><p><strong>unit_cell</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – The unit cell parameters. shape=(6,) these are in Angstroms and degrees, ordered as [a,b,c,alpha,beta,gamma].</p></li>
<li><p><strong>hkl</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – The hkl indices. shape=(3,) these are integers.</p></li>
<li><p><strong>reference_bragg_angle</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – The reference Bragg angle in degrees. This is the Bragg angle for the reference unit cell and the reference hkl.</p></li>
<li><p><strong>cell.</strong> (<em>i.e it is the angle at which diffraction will be observed for a strain free unit</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The strain. shape=(n,) or float.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.ccmth_to_wavelength">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">ccmth_to_wavelength</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ccmth</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.ccmth_to_wavelength" title="Link to this definition">#</a></dt>
<dd><p>Convert monochromator position (ccmth) to wavelength.</p>
<p>NOTE: we use d_Si_111 = 3.1384245 as the calibrated value for the Si(111) reflection, which
is the monochromator material at ID03 ESRF.</p>
<p>This was derived from a 3DXRD measurement assuming no offsets in ccmth using a calibration
crystal that was known to be strain-free.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ccmth</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – The ccmth in degrees. shape=(n,) or float.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The wavelength in Angstroms. shape=(n,) or float.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.ccmth_to_energy">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">ccmth_to_energy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ccmth</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.ccmth_to_energy" title="Link to this definition">#</a></dt>
<dd><p>Convert monochromator position (ccmth) to energy.</p>
<p>NOTE: we use d_Si_111 = 3.1384245 as the calibrated value for the Si(111) reflection, which
is the monochromator material at ID03 ESRF.</p>
<p>This was derived from a 3DXRD measurement assuming no offsets in ccmth using a calibration
crystal that was known to be strain-free.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ccmth</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – The ccmth in degrees. shape=(n,) or float.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The energy in keV. shape=(n,) or float.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.wavelength_to_energy">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">wavelength_to_energy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wavelength</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.wavelength_to_energy" title="Link to this definition">#</a></dt>
<dd><p>Convert wavelength to energy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>wavelength</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – The wavelength in Angstroms.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The energy in keV.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.energy_to_wavelength">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">energy_to_wavelength</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">energy</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.energy_to_wavelength" title="Link to this definition">#</a></dt>
<dd><p>Convert energy to wavelength.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>energy</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>) – The energy in keV.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The wavelength in Angstroms.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.reciprocal_basis">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">reciprocal_basis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lattice_parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degrees</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.reciprocal_basis" title="Link to this definition">#</a></dt>
<dd><p>Calculate the reciprocal basis vectors.</p>
<p>Calculate B matrix such that B^-T contains the reals space lattice vectors as columns.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lattice_parameters</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code>) – unit cell parameters [a,b,c,alpha,beta,gamma].</p></li>
<li><p><strong>degrees</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) – If True, the angles (alpha, beta, gamma) are assumed to be in degrees, otherwise they are in radians. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The B matrix. <code class="docutils literal notranslate"><span class="pre">shape=(3,3)</span></code></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>B (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.diffraction_vectors">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">diffraction_vectors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grain_orientation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lattice_parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hkl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">omega</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frame</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lab'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degrees</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.diffraction_vectors" title="Link to this definition">#</a></dt>
<dd><p>Compute the diffraction vectors over a spatial field.</p>
<p>Diffraction vectors, G, are defined from the Laue equation:</p>
<blockquote>
<div><p>G_lab = O &#64; U &#64; B &#64; hkl</p>
</div></blockquote>
<p>where O is the goniometer rotation, U is the grain orientation, B is the reciprocal basis
and hkl are the integer Miller indices. The vector</p>
<blockquote>
<div><p>G_crystal = B &#64; hkl</p>
</div></blockquote>
<p>is the diffraction vector in the crystal frame and the vector</p>
<blockquote>
<div><p>G_sample = U &#64; G_crystal</p>
</div></blockquote>
<p>is the diffraction vector in the sample frame. The rotation O is the goniometer rotation which maps
from sample space to lab space as</p>
<blockquote>
<div><p>G_lab = O &#64; G_sample</p>
</div></blockquote>
<p>The lab reference frame is defined with x along the x-ray beam propagation direction, z towards the
roof and y traverse, such that x, y and z form a right-handed coordinate system. The definition of
U and B follows 3DXRD conventions.</p>
<p>See also Poulsen 2004: <a class="reference external" href="https://orbit.dtu.dk/en/publications/3dxrd-a-new-probe-for-materials-science">https://orbit.dtu.dk/en/publications/3dxrd-a-new-probe-for-materials-science</a></p>
<p>NOTE: Sometimes G is denoted as Q in DFXM.</p>
<p>Here, any of the input angles can be a scalar or an array. The largest dimension of the input angles will be used
to determine the shape of the output diffraction vector field. For instace if mu is mu.shape=(m,n) then the output
diffraction vector field will have shape=(m,n,3) etc.</p>
<dl class="simple">
<dt>Computation is done in the following order:</dt><dd><ol class="arabic simple">
<li><p>Convert hkl into the crystal frame via reciprocal_basis.</p></li>
<li><p>Convert crystal diffraction vectors into the sample frame via grain_orientation.</p></li>
<li><p>Convert sample diffraction vectors into the lab frame via goniometer.total_rotation (using the mean angular position of goniometer).</p></li>
<li><p>Convert lab diffraction vectors into the requested frame via _from_lab_to_frame.</p></li>
</ol>
</dd>
</dl>
<p>NOTE: if no mask is provided a mask will be impliclty created as ~np.isnan(angle) where angle is one of mu, omega, chi or phi,
depending on which one/ones of the input angles have a size&gt;1</p>
<p>Example use-case for a mosaicity-scan:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">darling</span>

<span class="n">U0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="mf">0.83550027</span><span class="p">,</span> <span class="mf">0.33932153</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.43220389</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.01167249</span><span class="p">,</span> <span class="mf">0.77541728</span><span class="p">,</span> <span class="mf">0.63134127</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.54936605</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.53253069</span><span class="p">,</span> <span class="mf">0.64390062</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">hkl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">lattice_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.05</span><span class="p">,</span> <span class="mf">4.05</span><span class="p">,</span> <span class="mf">4.05</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
<span class="n">mosa</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">mosa_field</span><span class="p">()</span>

<span class="n">diff_vecs</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">diffraction_vectors</span><span class="p">(</span>
    <span class="n">grain_orientation</span><span class="o">=</span><span class="n">U0</span><span class="p">,</span>
    <span class="n">lattice_parameters</span><span class="o">=</span><span class="n">lattice_parameters</span><span class="p">,</span>
    <span class="n">hkl</span><span class="o">=</span><span class="n">hkl</span><span class="p">,</span>
    <span class="n">mu</span><span class="o">=</span><span class="n">mosa</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">omega</span><span class="o">=</span><span class="mf">17.83</span><span class="p">,</span>
    <span class="n">chi</span><span class="o">=</span><span class="n">mosa</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">phi</span><span class="o">=</span><span class="mf">0.61</span><span class="p">,</span>
    <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span>
    <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grain_orientation</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code>) – The grain orientation as shape=(3,3) matrix or rotation object.</p></li>
<li><p><strong>lattice_parameters</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – The lattice parameters. shape=(6,)</p></li>
<li><p><strong>hkl</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – The hkl indices. shape=(3,)</p></li>
<li><p><strong>mu</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – The mu angle. shape=(n,) or float</p></li>
<li><p><strong>omega</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – The omega angle. shape=(n,) or float.</p></li>
<li><p><strong>chi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – The chi angle. shape=(n,) or float.</p></li>
<li><p><strong>phi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – The phi angle. shape=(n,) or float..</p></li>
<li><p><strong>frame</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>, optional) – The frame of the diffraction vectors. Defaults to “lab”. Options are “lab”, “sample” or “crystal”.</p></li>
<li><p><strong>mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) – The mask to apply to the diffraction vectors. Defaults to None.</p></li>
<li><p><strong>degrees</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) – If True, the angles are assumed to be in degrees, otherwise they are in radians. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>The diffraction vectors as a field. shape=(n,3) or shape=(m,n,3) etc. depending on input angles. The reference</dt><dd><p>frame of the diffraction vectors is the one specified by the frame argument.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.align_vector_bundle">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">align_vector_bundle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_vector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vector_bundle</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.align_vector_bundle" title="Link to this definition">#</a></dt>
<dd><p>Align a target vector with a vector bundle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target_vector</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – The target vector. shape=(3,)</p></li>
<li><p><strong>vector_bundle</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – The vector bundle. shape=(n,3)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>The minimal rotations needed to align the target vector with each</dt><dd><p>vector in the vector bundle. len=n</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.minimal_norm_rotation">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">minimal_norm_rotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">diffraction_vector_field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lattice_parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hkl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_orientation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotation_representation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'object'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degrees</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">difference_rotation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.minimal_norm_rotation" title="Link to this definition">#</a></dt>
<dd><p>Find the smallest rotation elements in SO3 that aligns a mean diffraction vector with a field of target diffraction vectors.</p>
<p>This function is usefull when estimating local grain orientations form an angular DFXM scan.</p>
<p>Given that the input <code class="docutils literal notranslate"><span class="pre">diffraction_vector_field</span></code> are defomred versions of a fixed diffraction vector,</p>
<blockquote>
<div><p>G0_sample = <code class="docutils literal notranslate"><span class="pre">grain_orientation</span></code> &#64; B &#64; hkl</p>
</div></blockquote>
<p>This function finds orientation elements that can perturb <code class="docutils literal notranslate"><span class="pre">grain_orientation</span></code> such that G0_sample is aligned with the
input <code class="docutils literal notranslate"><span class="pre">diffraction_vector_field</span></code> at each point. I.e the output rotations represent the local grain orientation, U=U(x)
computed as a sequential transform, first rotating to the <code class="docutils literal notranslate"><span class="pre">grain_orientation</span></code>, and then applying the incremental rotations
to reach each diffraction vector in the <code class="docutils literal notranslate"><span class="pre">diffraction_vector_field</span></code>. (when <code class="docutils literal notranslate"><span class="pre">difference_rotation</span></code> is True, only the
incremental part of the rotation is returned)</p>
<p>NOTE: When the <code class="docutils literal notranslate"><span class="pre">grain_orientation</span></code> is the identity matrix, the input <code class="docutils literal notranslate"><span class="pre">diffraction_vector_field</span></code> is expected to be in crystal coordinates.
Otherwise it is expected to be in sample coordinates.</p>
<p>Example use-case for a mosaicity-scan:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">darling</span>

<span class="n">U0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="mf">0.83550027</span><span class="p">,</span> <span class="mf">0.33932153</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.43220389</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.01167249</span><span class="p">,</span> <span class="mf">0.77541728</span><span class="p">,</span> <span class="mf">0.63134127</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.54936605</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.53253069</span><span class="p">,</span> <span class="mf">0.64390062</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">hkl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">lattice_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.05</span><span class="p">,</span> <span class="mf">4.05</span><span class="p">,</span> <span class="mf">4.05</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
<span class="n">mosa</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">mosa_field</span><span class="p">()</span>

<span class="n">diff_vecs</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">diffraction_vectors</span><span class="p">(</span>
    <span class="n">grain_orientation</span><span class="o">=</span><span class="n">U0</span><span class="p">,</span>
    <span class="n">lattice_parameters</span><span class="o">=</span><span class="n">lattice_parameters</span><span class="p">,</span>
    <span class="n">hkl</span><span class="o">=</span><span class="n">hkl</span><span class="p">,</span>
    <span class="n">mu</span><span class="o">=</span><span class="n">mosa</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">omega</span><span class="o">=</span><span class="mf">17.83</span><span class="p">,</span>
    <span class="n">chi</span><span class="o">=</span><span class="n">mosa</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">phi</span><span class="o">=</span><span class="mf">0.61</span><span class="p">,</span>
    <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span>
    <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">rotation_field</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">minimal_norm_rotation</span><span class="p">(</span>
    <span class="n">diff_vecs</span><span class="p">,</span>
    <span class="n">lattice_parameters</span><span class="p">,</span>
    <span class="n">hkl</span><span class="p">,</span>
    <span class="n">grain_orientation</span><span class="o">=</span><span class="n">U0</span><span class="p">,</span>
    <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rotation_representation</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">difference_rotation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>diffraction_vector_field</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – The diffraction vector field. shape=(n,3) or shape=(m,n,3) etc. When a <cite>grain_orientation</cite> is provided,
the <cite>diffraction_vector_field</cite> is expected to be in sample frame. Otherwise it is expected to be in crystal coordinates.</p></li>
<li><p><strong>lattice_parameters</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – The lattice parameters. shape=(6,)</p></li>
<li><p><strong>hkl</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code>) – The hkl indices. shape=(3,)</p></li>
<li><p><strong>grain_orientation</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code>, optional) – The grain orientation as shape=(3,3) matrix or rotation object. Defaults to <cite>np.eye(3)</cite>
in which case the input <cite>diffraction_vector_field</cite> is expected to be in crystal coordinates. Otherwise <cite>diffraction_vector_field</cite> is expected to be in sample coordinates.</p></li>
<li><p><strong>mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) – The mask to apply to the diffraction vectors. Defaults to None.</p></li>
<li><p><strong>rotation_representation</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>, optional) – The representation of the rotation. Defaults to “object”. Options are “object”, “quat”, “matrix”, “rotvec”. Additionally, “euler-seq”
can be passed where seq are 3 characters belonging to the set {‘X’, ‘Y’, ‘Z’} for intrinsic rotations, or {‘x’, ‘y’, ‘z’}
for extrinsic rotations. Adjacent axes cannot be the same. Extrinsic and intrinsic rotations cannot be mixed in one
function call. This is a wrapper around scipy.spatial.transform.Rotation, for more details see the documentation for that class:
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.transform.Rotation.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.transform.Rotation.html</a></p></li>
<li><p><strong>degrees</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) – If True, the angles are assumed to be in degrees, otherwise they are in radians. Defaults to True.</p></li>
<li><p><strong>difference_rotation</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) – If True, an incremental rotation is returned representing the difference rotation needed to bring the reference diffraction vector
to the input <cite>diffraction_vector_field</cite>. If False, the full rotation is returned i.e the rotations represents the local grain orientation, U=U(x). Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The minimal norm rotations. shape=(n,3) or shape=(m,n,3) etc.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.transforms.as_rotation_representation">
<span class="sig-prename descclassname"><span class="pre">darling.transforms.</span></span><span class="sig-name descname"><span class="pre">as_rotation_representation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rotation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotation_representation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degrees</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/transforms.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.transforms.as_rotation_representation" title="Link to this definition">#</a></dt>
<dd><p>Convert the rotation to the requested representation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rotation</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code>) – The rotation to convert.</p></li>
<li><p><strong>rotation_representation</strong> (<em>str</em>) – The representation of the rotation. Options are “object”, “quat”, “matrix”, “rotvec”. Additionally, “euler-seq”</p></li>
<li><p><strong>{'X'</strong> (<em>can be passed where seq are 3 characters belonging to the set</em>)</p></li>
<li><p><strong>'Y'</strong></p></li>
<li><p><strong>rotations</strong> (<em>'Z'} for intrinsic</em>)</p></li>
<li><p><strong>{'x'</strong> (<em>or</em>)</p></li>
<li><p><strong>'y'</strong></p></li>
<li><p><strong>'z'}</strong></p></li>
<li><p><strong>one</strong> (<em>for extrinsic rotations. Adjacent axes cannot be the same. Extrinsic and intrinsic rotations cannot be mixed in</em>)</p></li>
<li><p><strong>scipy.spatial.transform.Rotation</strong> (<em>function call. This is a wrapper around</em>)</p></li>
<li><p><strong>class</strong> (<em>for more details see the documentation for that</em>)</p></li>
<li><p><strong>https</strong> – //docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.transform.Rotation.html</p></li>
<li><p><strong>degrees</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the angles are assumed to be in degrees, otherwise they are in radians. Defaults to True. Only used for euler-seq.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The rotation in the requested representation. Dimensions will match the input array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-darling.goniometer">
<span id="goniometer"></span><h2>goniometer<a class="headerlink" href="#module-darling.goniometer" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="darling.goniometer.total_rotation">
<span class="sig-prename descclassname"><span class="pre">darling.goniometer.</span></span><span class="sig-name descname"><span class="pre">total_rotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">omega</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degrees</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotation_representation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'object'</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/goniometer.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.goniometer.total_rotation" title="Link to this definition">#</a></dt>
<dd><p>Goniometer rotation for the ID03 DFXM microscope (september 2025).</p>
<p>This class is currently implemneted for the case of Dark Field X-ray Microscopy (DFXM) where
the gonimeter/hexapod has 4 degrees of freedom (mu, omega, chi, phi). Stacked as:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>base : mu</p></li>
<li><p>bottom : omega</p></li>
<li><p>top 1    : chi</p></li>
<li><p>top 2    : phi</p></li>
</ol>
</div></blockquote>
<p>Here mu is a rotation about the negative y-axis, omega is a positive rotation about the
z-axis, chi is a positive rotation about the x-axis, and phi is a positive rotation about
the y-axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mu</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for the base cradle motor, mu. shape=(n,) or float.</p></li>
<li><p><strong>omega</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for omega motor. shape=(n,) or float.</p></li>
<li><p><strong>chi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for chi motor. shape=(n,) or float.</p></li>
<li><p><strong>phi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for the top motor, phi. shape=(n,) or float.</p></li>
<li><p><strong>degrees</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the angles are assumed to be in degrees, otherwise they are in radians. Defaults to True.</p></li>
<li><p><strong>rotation_representation</strong> (<em>str</em><em>, </em><em>optional</em>) – The representation of the rotation. Defaults to “object” in which case the rotation is</p></li>
<li><p><strong>&quot;quat&quot;</strong> (<em>returned as a scipy.spatial.transform.Rotation object. Other options are</em>)</p></li>
<li><p><strong>&quot;matrix&quot;</strong></p></li>
<li><p><strong>Additoinally</strong> (<em>&quot;rotvec&quot;.</em>)</p></li>
<li><p><strong>&quot;euler-seq&quot;</strong></p></li>
<li><p><strong>{'X'</strong> (<em>can be passed where seq are 3 characters belonging to the set</em>)</p></li>
<li><p><strong>'Y'</strong></p></li>
<li><p><strong>rotations</strong> (<em>'Z'} for intrinsic</em>)</p></li>
<li><p><strong>{'x'</strong> (<em>or</em>)</p></li>
<li><p><strong>'y'</strong></p></li>
<li><p><strong>'z'}</strong></p></li>
<li><p><strong>one</strong> (<em>for extrinsic rotations. Adjacent axes cannot be the same. Extrinsic and intrinsic rotations cannot be mixed in</em>)</p></li>
<li><p><strong>scipy.spatial.transform.Rotation</strong> (<em>function call. This is a wrapper around</em>)</p></li>
<li><p><strong>class</strong> (<em>for more details see the documentation for that</em>)</p></li>
<li><p><strong>https</strong> – //docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.transform.Rotation.html</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The total rotation of the stage. Dimensions will match the largest input array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.goniometer.mu_rotation">
<span class="sig-prename descclassname"><span class="pre">darling.goniometer.</span></span><span class="sig-name descname"><span class="pre">mu_rotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degrees</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/goniometer.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.goniometer.mu_rotation" title="Link to this definition">#</a></dt>
<dd><p>Rotation about the negative y-axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mu</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for the base cradle motor, mu.</p></li>
<li><p><strong>degrees</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the angles are assumed to be in degrees, otherwise they are in radians. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The rotation about the negative y-axis. Dimensions will match the input array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.goniometer.omega_rotation">
<span class="sig-prename descclassname"><span class="pre">darling.goniometer.</span></span><span class="sig-name descname"><span class="pre">omega_rotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">omega</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degrees</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/goniometer.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.goniometer.omega_rotation" title="Link to this definition">#</a></dt>
<dd><p>Rotation about the z-axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>omega</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for omega motor.</p></li>
<li><p><strong>degrees</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the angles are assumed to be in degrees, otherwise they are in radians. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The rotation about the z-axis. Dimensions will match the input array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.goniometer.chi_rotation">
<span class="sig-prename descclassname"><span class="pre">darling.goniometer.</span></span><span class="sig-name descname"><span class="pre">chi_rotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degrees</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/goniometer.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.goniometer.chi_rotation" title="Link to this definition">#</a></dt>
<dd><p>Rotation about the x-axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>chi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for chi motor.</p></li>
<li><p><strong>degrees</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the angles are assumed to be in degrees, otherwise they are in radians. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The rotation about the x-axis. Dimensions will match the input array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.goniometer.phi_rotation">
<span class="sig-prename descclassname"><span class="pre">darling.goniometer.</span></span><span class="sig-name descname"><span class="pre">phi_rotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degrees</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/goniometer.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.goniometer.phi_rotation" title="Link to this definition">#</a></dt>
<dd><p>Rotation about the y-axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>phi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for the top motor.</p></li>
<li><p><strong>degrees</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the angles are assumed to be in degrees, otherwise they are in radians. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The rotation about the y-axis. Dimensions will match the input array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.goniometer.median_rotation">
<span class="sig-prename descclassname"><span class="pre">darling.goniometer.</span></span><span class="sig-name descname"><span class="pre">median_rotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">omega</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degrees</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotation_representation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'object'</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/goniometer.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.goniometer.median_rotation" title="Link to this definition">#</a></dt>
<dd><p>Median rotation for the goniometer. Usefull when mu, omega, chi or phi are arrays of size&gt;1 and a single
reference rotation is needed. The median is taken over the angles for each motor.</p>
<p>Input angles can be either float or np.ndarray of arbitrary dimensions. angular medians are computed over
all elements of the array that are not numpy.nans.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mu</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for the base cradle motor, mu.</p></li>
<li><p><strong>omega</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for omega motor.</p></li>
<li><p><strong>chi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for chi motor.</p></li>
<li><p><strong>phi</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Goniometer angle for the top motor.</p></li>
<li><p><strong>degrees</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the angles are assumed to be in degrees, otherwise they are in radians. Defaults to True.</p></li>
<li><p><strong>rotation_representation</strong> (<em>str</em><em>, </em><em>optional</em>) – The representation of the rotation. Defaults to “object” in which case the rotation is</p></li>
<li><p><strong>&quot;quat&quot;</strong> (<em>returned as a scipy.spatial.transform.Rotation object. Other options are</em>)</p></li>
<li><p><strong>&quot;matrix&quot;</strong></p></li>
<li><p><strong>Additoinally</strong> (<em>&quot;rotvec&quot;.</em>)</p></li>
<li><p><strong>&quot;euler-seq&quot;</strong></p></li>
<li><p><strong>{'X'</strong> (<em>can be passed where seq are 3 characters belonging to the set</em>)</p></li>
<li><p><strong>'Y'</strong></p></li>
<li><p><strong>rotations</strong> (<em>'Z'} for intrinsic</em>)</p></li>
<li><p><strong>{'x'</strong> (<em>or</em>)</p></li>
<li><p><strong>'y'</strong></p></li>
<li><p><strong>'z'}</strong></p></li>
<li><p><strong>one</strong> (<em>for extrinsic rotations. Adjacent axes cannot be the same. Extrinsic and intrinsic rotations cannot be mixed in</em>)</p></li>
<li><p><strong>scipy.spatial.transform.Rotation</strong> (<em>function call. This is a wrapper around</em>)</p></li>
<li><p><strong>class</strong> (<em>for more details see the documentation for that</em>)</p></li>
<li><p><strong>https</strong> – //docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.transform.Rotation.html</p></li>
<li><p><strong>ValueError</strong> – Expected input goniometer angles (mu, omega, chi, phi) to be either float or np.ndarray of size&gt;1</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The median rotation. Dimensions will match the input array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-darling.peaksearcher">
<span id="peaksearcher"></span><h2>peaksearcher<a class="headerlink" href="#module-darling.peaksearcher" title="Link to this heading">#</a></h2>
<p>This module defines a discrete peak searcher algorithm for 2D data.</p>
<p>This module enables segmentation of 2D data into domains of interest and allow for extraction
of features from these domains. The algorithm is based on a gradient ascent in the data map
moving in a manhattan-like fashion. The algorithm is implemented in numba and can be run in
parallel.</p>
<p>The final result is a gaussian mixture model of a grid of images. The features extracted
from the segmented domains are stored in a feature table. The feature table is a dictionary
with keys corresponding to the features extracted from the segmented domains. The feature
table can be converted to motor positions if motor positions are provided.</p>
<p>Specifically, for each located peak, the following features are extracted:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>sum_intensity</strong>: Sum of the intensity values in the segmented domain.</p></li>
<li><p><strong>number_of_pixels</strong>: Number of pixels in the segmented domain.</p></li>
<li><p><strong>mean_row</strong>: Mean row position in the segmented domain.</p></li>
<li><p><strong>mean_col</strong>: Mean column position in the segmented domain.</p></li>
<li><p><strong>var_row</strong>: Variance of the row positions in the segmented domain.</p></li>
<li><p><strong>var_col</strong>: Variance of the column positions in the segmented domain.</p></li>
<li><p><strong>var_row_col</strong>: Covariance of the row and column positions in the segmented domain.</p></li>
<li><p><strong>max_pix_row</strong>: Row position of the pixel with the highest intensity.</p></li>
<li><p><strong>max_pix_col</strong>: Column position of the pixel with the highest intensity.</p></li>
<li><p><strong>max_pix_intensity</strong>: Intensity of the pixel with the highest intensity.</p></li>
</ul>
</div></blockquote>
<p>Additionally, when motor coordinate arrays are provided, the following features are included:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>mean_motor1</strong>: Mean motor position for the first motor.</p></li>
<li><p><strong>mean_motor2</strong>: Mean motor position for the second motor.</p></li>
<li><p><strong>var_motor1</strong>: Variance of the motor positions for the first motor.</p></li>
<li><p><strong>var_motor2</strong>: Variance of the motor positions for the second motor.</p></li>
<li><p><strong>var_motor1_motor2</strong>: Covariance of the motor positions for the first and second motor.</p></li>
<li><p><strong>max_pix_motor1</strong>: Motor position for the first motor of the pixel with the highest intensity.</p></li>
<li><p><strong>max_pix_motor2</strong>: Motor position for the second motor of the pixel with the highest intensity.</p></li>
</ul>
</div></blockquote>
<dl class="py function">
<dt class="sig sig-object py" id="darling.peaksearcher.label_sparse">
<span class="sig-prename descclassname"><span class="pre">darling.peaksearcher.</span></span><span class="sig-name descname"><span class="pre">label_sparse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/peaksearcher.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.peaksearcher.label_sparse" title="Link to this definition">#</a></dt>
<dd><p>Assigns pixels in a 2D image to the closest local maxima.</p>
<p>The algorithm proceeds as follows:</p>
<ol class="arabic">
<li><p>For a given pixel, find the highest-valued neighbor.</p></li>
<li><p>Move the pixel to this neighbor:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>If the neighbor is already labeled, propagate the label back to the pixel.</p></li>
<li><p>If the pixel is a local maximum, assign it a new label.</p></li>
<li><p>Otherwise, repeat step 1 until a label is assigned.</p></li>
</ol>
</div></blockquote>
</li>
</ol>
<p>This process ensures that each pixel is assigned to the nearest local maximum
through a gradient ascent type climb.</p>
<p>To illustrate how the local maxclimber algorithm can separate overlapping gaussians
we can consider the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">darling</span>

<span class="c1"># Create a synthetic image with 9 gaussians with a lot of overlap</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">127</span><span class="p">,</span> <span class="mi">385</span><span class="p">,</span> <span class="mi">127</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">127</span><span class="p">,</span> <span class="mi">385</span><span class="p">,</span> <span class="mi">127</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Label the image following the local max climber algorithm</span>
<span class="n">labeled_array</span><span class="p">,</span> <span class="n">nfeatures</span> <span class="o">=</span> <span class="n">darling</span><span class="o">.</span><span class="n">peaksearcher</span><span class="o">.</span><span class="n">label_sparse</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="c1"># The segmented image shows how the local maxclimber algorithm has segmented the image</span>
<span class="c1"># into 9 regions splitting the overlapping gaussians.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">labeled_array</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab20&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Original image&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Labeled image&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/labeloverlap.png" src="_images/labeloverlap.png" />
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – a 2D data map to process. shape=(m,n)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a 2D array with the same shape as the input data
number_of_labels (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>): the number of labels assigned to the data map</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>labeled_array (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="darling.peaksearcher.extract_features">
<span class="sig-prename descclassname"><span class="pre">darling.peaksearcher.</span></span><span class="sig-name descname"><span class="pre">extract_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labeled_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/peaksearcher.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.peaksearcher.extract_features" title="Link to this definition">#</a></dt>
<dd><p>Extract features from a labeled array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labeled_array</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Label array with shape (m,n)</p></li>
<li><p><strong>data</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – The underlying intensity data array with shape (m,n)</p></li>
<li><p><strong>k</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>) – number of segmented domains to keep features for
The domain with the highest sum_intensity will be kept.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>a 2D array with the extracted features with indices following</dt><dd><p>a static _FEATURE_MAPPING dict.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>‘numpy array’</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-darling.metadata">
<span id="metadata"></span><h2>metadata<a class="headerlink" href="#module-darling.metadata" title="Link to this heading">#</a></h2>
<p>The metadata module is intended to contain easy configuration for the different beamlines/ changes
in beamline data storage formatting.</p>
<p>The ID03 object is used internally by darling to interface the ESRF ID03 beamline data storage.
It contains specific information on how to fetch motor names, scan shapes and other meta-data from
a h5 file.</p>
<dl class="py class">
<dt class="sig sig-object py" id="darling.metadata.ID03">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">darling.metadata.</span></span><span class="sig-name descname"><span class="pre">ID03</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">abs_path_to_h5_file</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/metadata.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.metadata.ID03" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>The configuration object parses &amp; fetches meta-data on the used motors and
scan configuration from the h5 file. This one is specific to the ID03 beamline
at the ESRF following the bliss configuration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>abs_path_to_h5_file</strong> (<em>str</em>) – The absolute path to the h5 file.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="darling.metadata.ID03.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan_id</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/metadata.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.metadata.ID03.__call__" title="Link to this definition">#</a></dt>
<dd><p>Return a dictionary of scan parameters, including scan shape, motor names etc.</p>
<p>The possible scan_command options for ID03 are</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ascan<span class="w"> </span>motor<span class="w"> </span>start<span class="w"> </span>stop<span class="w"> </span>intervals<span class="w"> </span>...
fscan<span class="w"> </span>motor<span class="w"> </span>start<span class="w"> </span>stop<span class="w"> </span>steps<span class="w"> </span>...
a2scan<span class="w"> </span>motor1<span class="w"> </span>start1<span class="w"> </span>stop1<span class="w"> </span>motor2<span class="w"> </span>start2<span class="w"> </span>stop2<span class="w"> </span>intervals<span class="w"> </span>...
d2scan<span class="w"> </span>motor1<span class="w"> </span>start1<span class="w"> </span>stop1<span class="w"> </span>motor2<span class="w"> </span>start2<span class="w"> </span>stop2<span class="w"> </span>intervals<span class="w"> </span>...
fscan2d<span class="w"> </span>motor1<span class="w"> </span>start1<span class="w"> </span>stop1<span class="w"> </span>steps1<span class="w"> </span>motor2<span class="w"> </span>start2<span class="w"> </span>stop2<span class="w"> </span>steps2<span class="w"> </span>...
</pre></div>
</div>
<p>The used command should be located under title in the h5 file. This
command is parsed to extract the scan shape, motor names and other
meta-data parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>scan_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – scan id to load from, e.g 1.1, 2.1 etc…</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>scan_params, dictionary of scan parameters;</dt><dd><p>scan_params[“scan_command”], scan_params[“scan_shape”],
scan_params[“motor_names”], scan_params[“integrated_motors”],
scan_params[“data_name”]</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-darling.utils">
<span id="utils"></span><h2>utils<a class="headerlink" href="#module-darling.utils" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="darling.utils.copyh5">
<span class="sig-prename descclassname"><span class="pre">darling.utils.</span></span><span class="sig-name descname"><span class="pre">copyh5</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detector_roi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(900,</span> <span class="pre">1100,</span> <span class="pre">900,</span> <span class="pre">1100)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detector_binning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/AxelHenningsson/darling/tree/main/darling/utils.py/"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#darling.utils.copyh5" title="Link to this definition">#</a></dt>
<dd><p>Recursive function to copy a h5 file from src to dst.</p>
<p>This can be used to copy DFXM h5 data while downsampling the detector data,
which is useful for creating smaller h5 files for testing and debugging in
darling. This function is not meant to tbe used for general purpose h5 file copying
or for darling end user data handling.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> (<em>str</em>) – Path to the source h5 file.</p></li>
<li><p><strong>dst</strong> (<em>str</em>) – Path to the destination h5 file.</p></li>
<li><p><strong>detector_roi</strong> (<em>tuple</em>) – ROI of the detector to copy. Defaults to (900, 1100, 900, 1100),
such that only the central 200x200 pixels are copied.</p></li>
<li><p><strong>detector_binning</strong> (<em>int</em>) – Binning of the detector to copy. Defaults to 1,
such that the entire detector is copied as is.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">DARLING</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#authors">Authors</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#usecase">Usecase</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-plotting-data">Loading &amp; plotting Data</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">Installation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-on-jupyter-the-esrf-slurm-cluster">Note on jupyter &amp; the ESRF slurm cluster</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation">Documentation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-darling._dataset">DataSet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling._dataset.DataSet"><code class="docutils literal notranslate"><span class="pre">DataSet</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling._dataset.DataSet.roi"><code class="docutils literal notranslate"><span class="pre">DataSet.roi</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling._dataset.DataSet.dtype"><code class="docutils literal notranslate"><span class="pre">DataSet.dtype</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling._dataset.DataSet.info"><code class="docutils literal notranslate"><span class="pre">DataSet.info()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling._dataset.DataSet.scan_params"><code class="docutils literal notranslate"><span class="pre">DataSet.scan_params</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling._dataset.DataSet.sensors"><code class="docutils literal notranslate"><span class="pre">DataSet.sensors</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling._dataset.DataSet.load_scan"><code class="docutils literal notranslate"><span class="pre">DataSet.load_scan()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling._dataset.DataSet.subtract"><code class="docutils literal notranslate"><span class="pre">DataSet.subtract()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling._dataset.DataSet.save"><code class="docutils literal notranslate"><span class="pre">DataSet.save()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-darling.reader">reader</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.reader.Reader"><code class="docutils literal notranslate"><span class="pre">Reader</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.reader.Reader.fetch"><code class="docutils literal notranslate"><span class="pre">Reader.fetch()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.reader.Reader.__call__"><code class="docutils literal notranslate"><span class="pre">Reader.__call__()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.reader.MosaScan"><code class="docutils literal notranslate"><span class="pre">MosaScan</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.reader.MosaScan.__call__"><code class="docutils literal notranslate"><span class="pre">MosaScan.__call__()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.reader.Darks"><code class="docutils literal notranslate"><span class="pre">Darks</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.reader.Darks.__call__"><code class="docutils literal notranslate"><span class="pre">Darks.__call__()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.reader.RockingScan"><code class="docutils literal notranslate"><span class="pre">RockingScan</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.reader.RockingScan.__call__"><code class="docutils literal notranslate"><span class="pre">RockingScan.__call__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-darling.assets">assets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.assets.path"><code class="docutils literal notranslate"><span class="pre">path()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.assets.mosa_field"><code class="docutils literal notranslate"><span class="pre">mosa_field()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.assets.domains"><code class="docutils literal notranslate"><span class="pre">domains()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.assets.rocking_scan"><code class="docutils literal notranslate"><span class="pre">rocking_scan()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.assets.motor_drift"><code class="docutils literal notranslate"><span class="pre">motor_drift()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.assets.mosaicity_scan"><code class="docutils literal notranslate"><span class="pre">mosaicity_scan()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.assets.energy_mu_scan"><code class="docutils literal notranslate"><span class="pre">energy_mu_scan()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.assets.energy_mosa_scan"><code class="docutils literal notranslate"><span class="pre">energy_mosa_scan()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.assets.gaussian_blobs"><code class="docutils literal notranslate"><span class="pre">gaussian_blobs()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-darling.filters">filters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.filters.snr_threshold"><code class="docutils literal notranslate"><span class="pre">snr_threshold()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.filters.gaussian_filter"><code class="docutils literal notranslate"><span class="pre">gaussian_filter()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-darling.properties">properties</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.properties.rgb"><code class="docutils literal notranslate"><span class="pre">rgb()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.properties.kam"><code class="docutils literal notranslate"><span class="pre">kam()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.properties.moments"><code class="docutils literal notranslate"><span class="pre">moments()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.properties.mean"><code class="docutils literal notranslate"><span class="pre">mean()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.properties.covariance"><code class="docutils literal notranslate"><span class="pre">covariance()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.properties.fit_1d_gaussian"><code class="docutils literal notranslate"><span class="pre">fit_1d_gaussian()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.properties.gaussian_mixture"><code class="docutils literal notranslate"><span class="pre">gaussian_mixture()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-darling.transforms">transforms</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.get_lattice_spacing"><code class="docutils literal notranslate"><span class="pre">get_lattice_spacing()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.ccmth_to_strain"><code class="docutils literal notranslate"><span class="pre">ccmth_to_strain()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.ccmth_to_wavelength"><code class="docutils literal notranslate"><span class="pre">ccmth_to_wavelength()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.ccmth_to_energy"><code class="docutils literal notranslate"><span class="pre">ccmth_to_energy()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.wavelength_to_energy"><code class="docutils literal notranslate"><span class="pre">wavelength_to_energy()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.energy_to_wavelength"><code class="docutils literal notranslate"><span class="pre">energy_to_wavelength()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.reciprocal_basis"><code class="docutils literal notranslate"><span class="pre">reciprocal_basis()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.diffraction_vectors"><code class="docutils literal notranslate"><span class="pre">diffraction_vectors()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.align_vector_bundle"><code class="docutils literal notranslate"><span class="pre">align_vector_bundle()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.minimal_norm_rotation"><code class="docutils literal notranslate"><span class="pre">minimal_norm_rotation()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.transforms.as_rotation_representation"><code class="docutils literal notranslate"><span class="pre">as_rotation_representation()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-darling.goniometer">goniometer</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.goniometer.total_rotation"><code class="docutils literal notranslate"><span class="pre">total_rotation()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.goniometer.mu_rotation"><code class="docutils literal notranslate"><span class="pre">mu_rotation()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.goniometer.omega_rotation"><code class="docutils literal notranslate"><span class="pre">omega_rotation()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.goniometer.chi_rotation"><code class="docutils literal notranslate"><span class="pre">chi_rotation()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.goniometer.phi_rotation"><code class="docutils literal notranslate"><span class="pre">phi_rotation()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.goniometer.median_rotation"><code class="docutils literal notranslate"><span class="pre">median_rotation()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-darling.peaksearcher">peaksearcher</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.peaksearcher.label_sparse"><code class="docutils literal notranslate"><span class="pre">label_sparse()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.peaksearcher.extract_features"><code class="docutils literal notranslate"><span class="pre">extract_features()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-darling.metadata">metadata</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.metadata.ID03"><code class="docutils literal notranslate"><span class="pre">ID03</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.metadata.ID03.__call__"><code class="docutils literal notranslate"><span class="pre">ID03.__call__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-darling.utils">utils</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#darling.utils.copyh5"><code class="docutils literal notranslate"><span class="pre">copyh5()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="_sources/index.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Axel Henningsson.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>